<Controls:MetroWindow x:Name="metroWindow" x:Class="Substation_Builder.View.DatabaseView"
                      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                      xmlns:mah="http://metro.mahapps.com/winfx/xaml/shared"
                      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                      xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
                      xmlns:vm="clr-namespace:Substation_Builder.ViewModel"
                      xmlns:Helpers="clr-namespace:Substation_Builder.Helpers"
                      xmlns:views ="clr-namespace:Substation_Builder.View"
                      xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls"
                      mc:Ignorable="d"
                      xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
                      Icon="..\Resources\Images\MainPageIcon.jpg"    
                      Title="One Line" ResizeMode="CanResizeWithGrip"
                      WindowStartupLocation="Manual"
                      BorderThickness="0" MinWidth="600" MinHeight="350" Width="600" Height="350">

    <Controls:MetroWindow.TitleTemplate>
        <DataTemplate>
            <TextBlock Text="{TemplateBinding Content}"
                   TextTrimming="CharacterEllipsis"
                   VerticalAlignment="Center"
                   FontSize="20px" Margin="20,0,0,0"/>
        </DataTemplate>
    </Controls:MetroWindow.TitleTemplate>

    <Controls:MetroWindow.DataContext>
        <vm:DatabaseViewModel/>
    </Controls:MetroWindow.DataContext>

    <Controls:MetroWindow.Resources>
        <mah:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <Style TargetType="{x:Type Controls:MetroTabItem}">
            <Setter Property="Controls:ControlsHelper.HeaderFontSize" Value="15"/>
        </Style>

        <Helpers:BindingProxy x:Key="DataContextProxy" Data="{Binding}"/>

        <!-- Remove Context Menu for Items in the control-->
        <!-- Incredibly evil as the contextmenu does not share the same datacontext as the treeview so the proxy is employed-->
        <ContextMenu x:Key="RemoveItemContext" DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
            <MenuItem Header="Delete Item" Command="{Binding Path=Data.RemoveItemCommand, Source={StaticResource DataContextProxy}}" CommandParameter="{Binding}"/>
        </ContextMenu>

    </Controls:MetroWindow.Resources>

    <Controls:MetroWindow.Background>
        <ImageBrush ImageSource="..\Resources/Images/Chiyome_Mochizuki.jpg" Opacity="0.25" Stretch="UniformToFill">
            <ImageBrush.RelativeTransform>
                <TransformGroup>
                    <ScaleTransform CenterY="0.5" CenterX="0.5" ScaleY="1" ScaleX="1"/>
                    <SkewTransform AngleY="0" AngleX="0" CenterY="0.5" CenterX="0.5"/>
                    <RotateTransform Angle="0" CenterY="0.5" CenterX="0.5"/>
                    <TranslateTransform/>
                </TransformGroup>
            </ImageBrush.RelativeTransform>
        </ImageBrush>
    </Controls:MetroWindow.Background>

    <Controls:MetroAnimatedSingleRowTabControl x:Name="metroAnimatedSingleRowTabControl">
        <Controls:MetroTabItem Header="DATABASE" TabIndex="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="4*"/>
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <DockPanel HorizontalAlignment="Left">
                        <Menu DockPanel.Dock="Left" VerticalAlignment="Center">
                            <MenuItem Header="New">
                                <MenuItem Header="New Project" Command="{Binding NewProjectCommand, Mode=OneWay}"/>
                                <MenuItem Header="Add Thevenin" Command="{Binding AddTheveninCommand, Mode=OneWay}"/>
                                <MenuItem Header="Add Transformer" Command="{Binding AddTransformerCommand, Mode=OneWay}"/>
                                <MenuItem Header="Add Relay" Command="{Binding AddRelayCommand, Mode=OneWay}"/>
                                <MenuItem Header="Add Breaker" Command="{Binding AddBreakerCommand, Mode=OneWay}"/>
                            </MenuItem>
                        </Menu>

                        <ToolBarTray DockPanel.Dock="Left" ToolBarTray.IsLocked="True" VerticalAlignment="Center" HorizontalAlignment="Left">
                            <ToolBar HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Button Content="Open" Command="{Binding LoadCommand}" FontSize="14"/>
                                <Button Content="Save" Command="{Binding SaveCommand}" FontSize="14"/>
                                <Button Content="Template" Command="{Binding TemplateCommand}" FontSize="14"/>
                            </ToolBar>
                        </ToolBarTray>
                    </DockPanel>

                    <TreeView x:Name="treeview" Grid.Column="1" Grid.Row="1" ItemsSource="{Binding Project}" VerticalAlignment="Top" SelectedItemChanged="LoadPage">

                        <TreeViewItem x:Name="Subdata" Header="{Binding Project.Name}" Background="{x:Null}">
                            <!-- This is the Header and Treeview Items for Thevenin-->
                            <TreeViewItem Header='Thevenin' ItemsSource="{Binding Project.Thevenins}">
                                <!-- This is the reeview Items for Thevenin-->
                                <TreeViewItem.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" PreviewMouseRightButtonDown="OnPreviewMouseRightButtonDown">
                                            <TextBlock.ContextMenu>
                                                <Binding Mode="OneWay" Source="{StaticResource RemoveItemContext}"/>
                                            </TextBlock.ContextMenu>
                                        </TextBlock>
                                    </DataTemplate>
                                </TreeViewItem.ItemTemplate>
                            </TreeViewItem>

                            <!-- This is the Header and Treeview Items for Transformer-->
                            <TreeViewItem Header='Transformer' ItemsSource="{Binding Project.Transformers}">
                                <!-- This is the reeview Items for Transformer-->
                                <TreeViewItem.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" PreviewMouseRightButtonDown="OnPreviewMouseRightButtonDown">
                                            <TextBlock.ContextMenu>
                                                <Binding Mode="OneWay" Source="{StaticResource RemoveItemContext}"/>
                                            </TextBlock.ContextMenu>
                                        </TextBlock>
                                    </DataTemplate>
                                </TreeViewItem.ItemTemplate>
                            </TreeViewItem>

                            <!-- This is the Header and Treeview Items for Relay-->
                            <TreeViewItem Header='Relay' ItemsSource="{Binding Project.Relays}">
                                <!-- This is the reeview Items for Relay-->
                                <TreeViewItem.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" PreviewMouseRightButtonDown="OnPreviewMouseRightButtonDown">
                                            <TextBlock.ContextMenu>
                                                <Binding Mode="OneWay" Source="{StaticResource RemoveItemContext}"/>
                                            </TextBlock.ContextMenu>
                                        </TextBlock>
                                    </DataTemplate>
                                </TreeViewItem.ItemTemplate>
                            </TreeViewItem>

                            <!-- This is the Header and Treeview Items for Breaker-->
                            <TreeViewItem Header='Breaker' ItemsSource="{Binding Project.Breakers}">
                                <!-- This is the reeview Items for Breaker-->
                                <TreeViewItem.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Name}" PreviewMouseRightButtonDown="OnPreviewMouseRightButtonDown">
                                            <TextBlock.ContextMenu>
                                                <Binding Mode="OneWay" Source="{StaticResource RemoveItemContext}"/>
                                            </TextBlock.ContextMenu>
                                        </TextBlock>
                                    </DataTemplate>
                                </TreeViewItem.ItemTemplate>
                            </TreeViewItem>
                            
                        </TreeViewItem>
                    </TreeView>
                </Grid>

                <StackPanel Grid.Column="1">
                    <Frame x:Name="pagenavigation" NavigationUIVisibility="Hidden" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,3,0,0"/>
                </StackPanel>

            </Grid>
        </Controls:MetroTabItem>

        <Controls:MetroTabItem Header="THEVENIN"  TabIndex="2">
            <Button Content="Load" Height="100" Width="75"/>
        </Controls:MetroTabItem>

        <Controls:MetroTabItem Header="TRANSFORMERS" TabIndex="3">

        </Controls:MetroTabItem>

        <Controls:MetroTabItem Header="RELAYS" TabIndex="4"/>

        <Controls:MetroTabItem Header="CTS" TabIndex="5"/>

    </Controls:MetroAnimatedSingleRowTabControl>

</Controls:MetroWindow>
    
